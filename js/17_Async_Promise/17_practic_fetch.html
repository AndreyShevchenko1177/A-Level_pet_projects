<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Luke Skywalker</title>
    </head>
    <body>
        <div class="wrapper" style="display: inline-flex">
            <div id="div1" style="margin: 10px; min-width: 400px; border: 2px solid red"></div>
            <div id="div2" style="margin: 10px; border: 2px solid red"></div>
        </div>
        <script>
            let objectToDom = function (domElement, person) {
                //
                const urlConst = "http://swapi.dev/api/";

                let setBtn = function (domEl, value) {
                    let btn = document.createElement("button");
                    btn.append(value.slice(urlConst.length));
                    domEl.append(btn);
                    // debugger;
                    btn.onclick = () => {
                        div2.removeChild(div2.firstChild);
                        fetch(value)
                            .then((res) => res.json())
                            .then((luke) => objectToDom(div2, luke));
                    };
                };

                let table = document.createElement("table");
                table.setAttribute("border", "1");
                domElement.append(table);
                console.log(person);
                for (item in person) {
                    let tr = document.createElement("tr");
                    table.append(tr);

                    let th = document.createElement("th");
                    tr.append(th);
                    th.append(item);

                    let td = document.createElement("td");
                    tr.append(td);

                    if (typeof person[item] == "string") {
                        if (person[item].startsWith(urlConst)) {
                            setBtn(td, person[item]);
                        } else
                            td.append(
                                new Date(person[item]).toString() !== "Invalid Date"
                                    ? new Date(person[item]).toDateString()
                                    : person[item]
                            );
                    } else {
                        if (Array.isArray(person[item])) {
                            for (val of person[item]) {
                                if (val.startsWith(urlConst)) {
                                    setBtn(td, val);
                                } else td.append(val);
                            }
                        }
                    }
                }
            };

            fetch("https://swapi.dev/api/people/1/")
                .then((res) => res.json())
                .then((luke) => objectToDom(div1, luke));

            fetch("https://swapi.dev/api/people/1/")
                .then((res) => res.json())
                .then((luke) => objectToDom(div2, luke));
        </script>
    </body>
</html>
