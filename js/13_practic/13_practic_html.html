<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width" />
        <title>Другой тайтл ПРИВЕТ 17й</title>
        <style></style>
    </head>
    <body>
        <h1 id="title"></h1>
        <div id="container1"></div>
        <div id="container2"></div>
        <script>
            function Control(el, { value = 0, step = 1, max = 100, min = 0, maxAngle = 360, minAngle = 0 } = {}) {
                const img = document.createElement("img");
                img.src = "1@3xNew.png";
                el.append(img);

                const ratio = (maxAngle - minAngle) / (max - min);

                const value2Deg = () => ratio * (value - min) + minAngle;

                const changeValue = (delta, fireEvent = false) => {
                    let newValue = value + delta;
                    if (newValue >= max) newValue = max;
                    if (newValue <= min) newValue = min;

                    value = newValue;

                    //console.log(value)

                    if (fireEvent && this.onChange && typeof this.onChange === "function") {
                        this.onChange(value);
                    }

                    img.style.transform = `rotate(${value2Deg()}deg)`;
                };

                const { top, left } = img.getBoundingClientRect();

                changeValue(0);

                console.log(img.width, top, left);

                img.onclick = (e) => {
                    changeValue(e.clientX - left > img.width / 2 ? step : -step, true);
                };

                img.onmousewheel = (e) => {
                    changeValue(e.deltaY * step, true);
                    e.preventDefault();
                };

                let startDragAngle;

                const calcAngle = ({ layerX, layerY }) => {
                    const deltaX = layerX - img.width / 2;
                    const deltaY = layerY - img.height / 2;
                    return (Math.atan2(deltaY, deltaX) / Math.PI) * 180;
                };

                img.onmousedown = (e) => {
                    startDragAngle = calcAngle(e);
                    e.preventDefault();
                };

                img.onmousemove = (e) => {
                    if (startDragAngle !== undefined) {
                        const currentAngle = calcAngle(e);
                        console.log(currentAngle);
                        const deltaAngle = (currentAngle - startDragAngle + 360) % 360;
                        // console.log(deltaAngle, "  ", currentAngle, "  ", startDragAngle);
                        changeValue(deltaAngle / ratio, true);
                        startDragAngle = currentAngle;
                        e.preventDefault();
                    }
                };

                img.onmouseup = img.onmouseout = (e) => {
                    if (startDragAngle) {
                        startDragAngle = undefined;
                        e.preventDefault();
                    }
                };

                this.setValue = (v) => changeValue(v - value);
                this.changeValue = changeValue;

                this.getValue = () => value;
            }

            const volumeControl = new Control(container1, { value: 50 });

            volumeControl.onChange = (value) => console.log("VOLUME", value);
            const balanceControl = new Control(container2, {
                maxAngle: 90,
                minAngle: -90,
                min: -50,
                max: 50,
                value: 0,
            });

            //

            //

            //
            /*
            function registerForm(el) {
                return new Promise((resolve, reject) => {
                    const loginInput = document.createElement("input");
                    const passwordInput = document.createElement("input");

                    const cancelButton = document.createElement("button");
                    const okButton = document.createElement("button");

                    el.append(loginInput);
                    el.append(passwordInput);

                    el.append(cancelButton);
                    okButton.innerText = "ok";
                    el.append(okButton);
                    cancelButton.innerText = "ne ok";

                    function clear() {
                        loginInput.remove();
                        passwordInput.remove();

                        okButton.remove();
                        cancelButton.remove();
                    }

                    okButton.onclick = () => {
                        clear();
                        resolve({ login: loginInput.value, password: passwordInput.value });
                    };

                    cancelButton.onclick = () => {
                        clear();
                        reject(new Error("cancel"));
                    };
                });
            }

            async function RegAndLog() {
                try {
                    title.innerText = "Register Please";
                    let regLogin, regPassword, a, b;
                    while (!regLogin || !regPassword) {
                        [{ login: regLogin, password: regPassword }] = [await registerForm(container)];
                    }
                    //                    await ServerRegister({regLogin, regPassword})

                    title.innerText = "Login Please";
                    const { login, password } = await registerForm(container);
                    console.log(login, password, regLogin, regPassword);
                    //                    await ServerLogin({login, password})
                    if (regLogin === login && regPassword === password) {
                        title.innerText = "Регистрация и Логин прошли ЗБС";
                    } else {
                        title.innerText = "Регистрация и Логин не прошли";
                    }
                } catch (e) {
                    title.innerText = "якийс негаразд: " + e.message;
                }
            }

            RegAndLog();
            let a = 5,
                b = 10;
            [{ a, b }] = [{ b, a }];
            console.log(a, b);
            */
        </script>
    </body>
</html>
